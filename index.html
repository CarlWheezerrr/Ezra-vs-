<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ezra vs Cody</title>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body, html {
            height: 100%;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            background: #f0f0f0;
        }

        /* Countdown Timer Styling */
        #countdown {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2em;
            font-weight: bold;
            color: #333;
            z-index: 2;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }

        /* Popup Styling */
        #popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: #fff;
            padding: 30px 50px;
            border-radius: 10px;
            display: none;
            z-index: 3;
            text-align: center;
            font-size: 1.5em;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        /* Overlay for Popup */
        #overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            z-index: 2;
        }

        .container {
            display: flex;
            height: 100%;
            width: 100%;
            transition: flex 0.5s ease;
            position: relative;
        }

        .side {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            transition: flex 0.5s ease;
            overflow: hidden;
        }

        /* Gradient Colors */
        #ezra {
            background: linear-gradient(135deg, #6DD5FA, #2980B9); /* Ezra's gradient */
            color: #fff;
            z-index: 1;
        }

        #cody {
            background: linear-gradient(135deg, #f093fb, #f5576c); /* Cody's gradient */
            color: #fff;
            z-index: 1;
        }

        .profile-pic {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            border: 5px solid rgba(255, 255, 255, 0.5);
            margin-bottom: 20px;
            transition: transform 0.2s;
        }

        .side:hover .profile-pic {
            transform: scale(1.05);
        }

        .name {
            font-size: 2em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .score {
            font-size: 3em;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        /* Animation styles */
        .float {
            position: absolute;
            animation: floatUp 1s ease-out forwards;
            pointer-events: none;
            color: #fff;
            font-weight: bold;
            font-size: 1.5em;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
            transform: translate(-50%, -50%);
            z-index: 2;
        }

        @keyframes floatUp {
            0% {
                opacity: 1;
                transform: translate(-50%, -50%) translateY(0);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) translateY(-50px);
            }
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .profile-pic {
                width: 100px;
                height: 100px;
            }

            .name {
                font-size: 1.5em;
            }

            .score {
                font-size: 2em;
            }

            #countdown {
                font-size: 1.5em;
            }

            #popup {
                font-size: 1.2em;
                padding: 20px 30px;
            }
        }
    </style>
</head>
<body>
    <!-- Countdown Timer -->
    <div id="countdown">15:00:00:00</div>

    <!-- Overlay for Popup -->
    <div id="overlay"></div>

    <!-- Popup Message -->
    <div id="popup"></div>

    <div class="container" id="container">
        <div class="side" id="ezra">
            <img src="https://avatars.worldcubeassociation.org/uploads/user/avatar/2022SAMU02/1643103082.jpeg" alt="Ezra" class="profile-pic">
            <div class="name">Ezra</div>
            <div class="score" id="ezra-score">0</div>
        </div>
        <div class="side" id="cody">
            <img src="data:image/webp;base64,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" alt="Cody" class="profile-pic">
            <div class="name">Cody</div>
            <div class="score" id="cody-score">0</div>
        </div>
    </div>

    <script>
        // Firebase configuration - Replace with your own config
        const firebaseConfig = {
            apiKey: "AIzaSyA77uZ_2qQKuZYbrjutvbqOjNzAZI8H3_s",
            authDomain: "ezra-vs-tbd.firebaseapp.com",
            databaseURL: "https://ezra-vs-tbd-default-rtdb.firebaseio.com",
            projectId: "ezra-vs-tbd",
            storageBucket: "ezra-vs-tbd.firebasestorage.app",
            messagingSenderId: "200660599850",
            appId: "1:200660599850:web:753485bc093de7b6e66f53",
            measurementId: "G-617BYYZE5R"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // References to score elements
        const ezraScoreEl = document.getElementById('ezra-score');
        const codyScoreEl = document.getElementById('cody-score');
        const container = document.getElementById('container');

        // References to database paths
        const ezraScoreRef = database.ref('scores/ezra');
        const codyScoreRef = database.ref('scores/cody');
        const timerRef = database.ref('timer');

        // Countdown duration in seconds (15 days)
        const COUNTDOWN_DURATION = 15 * 24 * 60 * 60; // 1,296,000 seconds

        // References to countdown elements
        const countdownEl = document.getElementById('countdown');
        const popupEl = document.getElementById('popup');
        const overlayEl = document.getElementById('overlay');

        // Initialize scores in database if not present
        ezraScoreRef.once('value').then(snapshot => {
            if (!snapshot.exists()) {
                ezraScoreRef.set(0);
            }
        });

        codyScoreRef.once('value').then(snapshot => {
            if (!snapshot.exists()) {
                codyScoreRef.set(0);
            }
        });

        // Initialize timer in database if not present
        timerRef.once('value').then(snapshot => {
            if (!snapshot.exists()) {
                const endTime = Date.now() + COUNTDOWN_DURATION * 1000;
                timerRef.set({
                    endTime: endTime
                });
            }
        });

        // Listen for score changes
        ezraScoreRef.on('value', (snapshot) => {
            if (snapshot.exists()) {
                ezraScoreEl.textContent = snapshot.val();
                updateContainerFlex();
            }
        });

        codyScoreRef.on('value', (snapshot) => {
            if (snapshot.exists()) {
                codyScoreEl.textContent = snapshot.val();
                updateContainerFlex();
            }
        });

        // Listen for timer changes
        timerRef.on('value', (snapshot) => {
            if (snapshot.exists()) {
                const endTime = snapshot.val().endTime;
                startCountdown(endTime);
            }
        });

        // Function to create floating "+1" at specific coordinates
        function createFloat(x, y) {
            const float = document.createElement('div');
            float.classList.add('float');
            float.style.left = `${x}px`;
            float.style.top = `${y}px`;
            float.textContent = "+1";
            document.body.appendChild(float);

            // Remove the element after animation
            float.addEventListener('animationend', () => {
                float.remove();
            });
        }

        // Function to increment score in Firebase
        function incrementScore(name) {
            const scoreRef = database.ref('scores/' + name);
            scoreRef.transaction((currentScore) => {
                return (currentScore || 0) + 1;
            });
        }

        // Event listeners for clicks on Ezra and Cody
        document.getElementById('ezra').addEventListener('click', (e) => {
            const x = e.clientX;
            const y = e.clientY;
            createFloat(x, y);
            incrementScore('ezra');
        });

        document.getElementById('cody').addEventListener('click', (e) => {
            const x = e.clientX;
            const y = e.clientY;
            createFloat(x, y);
            incrementScore('cody');
        });

        // Function to update the container's flex proportions based on scores
        function updateContainerFlex() {
            const ezraScore = parseInt(ezraScoreEl.textContent, 10);
            const codyScore = parseInt(codyScoreEl.textContent, 10);
            const total = ezraScore + codyScore;

            // Avoid division by zero
            if (total === 0) {
                container.style.flexDirection = 'row';
                container.childNodes.forEach(side => {
                    if (side.classList && side.classList.contains('side')) {
                        side.style.flex = "1";
                    }
                });
                return;
            }

            // Calculate percentage for Ezra and Cody
            const ezraPercent = (ezraScore / total) * 100;
            const codyPercent = (codyScore / total) * 100;

            // Set min and max flex percentages to avoid collapsing
            const minFlex = 20; // Minimum 20%
            let ezraFlex = Math.max(ezraPercent, minFlex);
            let codyFlex = Math.max(codyPercent, minFlex);

            // Adjust if total exceeds 100 due to minFlex
            const adjustedTotal = ezraFlex + codyFlex;
            if (adjustedTotal > 100) {
                ezraFlex = (ezraFlex / adjustedTotal) * 100;
                codyFlex = (codyFlex / adjustedTotal) * 100;
            }

            // Apply flex
            document.getElementById('ezra').style.flex = ezraFlex;
            document.getElementById('cody').style.flex = codyFlex;
        }

        // Function to start and manage the countdown timer
        let countdownInterval; // To store the interval ID

        function startCountdown(endTime) {
            // Clear any existing intervals
            if (countdownInterval) clearInterval(countdownInterval);

            function updateTimer() {
                const now = Date.now();
                const remainingMillis = Math.max(0, endTime - now);
                const remainingSeconds = Math.floor(remainingMillis / 1000);

                // Calculate days, hours, minutes, and seconds
                const days = Math.floor(remainingSeconds / (24 * 60 * 60));
                const hours = Math.floor((remainingSeconds % (24 * 60 * 60)) / 3600);
                const minutes = Math.floor((remainingSeconds % 3600) / 60);
                const seconds = remainingSeconds % 60;

                countdownEl.textContent = `${pad(days)}:${pad(hours)}:${pad(minutes)}:${pad(seconds)}`;

                if (remainingSeconds <= 0) {
                    clearInterval(countdownInterval);
                    showWinnerPopup();
                }
            }

            updateTimer(); // Initial call

            if (Date.now() < endTime) {
                countdownInterval = setInterval(updateTimer, 1000);
            } else {
                // Timer already expired
                showWinnerPopup();
            }
        }

        // Helper function to pad numbers with leading zeros
        function pad(number) {
            return number.toString().padStart(2, '0');
        }

        // Function to display the winner popup
        function showWinnerPopup() {
            const ezraScore = parseInt(ezraScoreEl.textContent, 10);
            const codyScore = parseInt(codyScoreEl.textContent, 10);

            let winner;
            if (ezraScore > codyScore) {
                winner = "Ezra";
            } else if (codyScore > ezraScore) {
                winner = "Cody";
            } else {
                winner = "Both are equally awesome!";
            }

            if (winner === "Both are equally awesome!") {
                popupEl.textContent = "It's a tie! Both are equally awesome!";
            } else {
                popupEl.textContent = `${winner} is the better sigma!`;
            }

            // Show the overlay and popup
            overlayEl.style.display = 'block';
            popupEl.style.display = 'block';

            // Clicking anywhere hides the popup
            // Remove existing listeners to prevent multiple bindings
            overlayEl.removeEventListener('click', hidePopup);
            popupEl.removeEventListener('click', hidePopup);

            overlayEl.addEventListener('click', hidePopup);
            popupEl.addEventListener('click', hidePopup);
        }

        // Function to hide the popup
        function hidePopup() {
            overlayEl.style.display = 'none';
            popupEl.style.display = 'none';
        }

        // Function to update the container's flex on initial load
        window.onload = () => {
            updateContainerFlex();
        };
    </script>
</body>
</html>
